{% extends 'auditorias/lista_generica.html' %}

{% block title %}Perfis de Acesso{% endblock %}
{% block page_title %}Perfis de Acesso{% endblock %}

{% block header_content %}
<div class="content-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        
        <div>
            <h2 class="content-title" style="margin-bottom: 8px; font-weight: bold; color: #333;">Perfis de Acesso</h2>
            <p class="content-subtitle text-muted mb-0">Gerencie os cargos e permissões dos usuários do sistema.</p>
        </div>

        <div>
            {# TRAVA DE SEGURANÇA: Só mostra se tiver permissão auth.add_group #}
            {% if perms.auth.add_group %}
            <a href="{% url 'usuarios:criar_grupo' %}" class="btn btn-primary shadow-sm">
                <i class="fas fa-plus mr-2"></i>
                Novo Grupo
            </a>
            {% endif %}
            
            <a href="{% url 'usuarios:lista_usuarios' %}" class="btn btn-secondary" style="background-color: #fff; color: #333; border: 1px solid #ddd;">
                <i class="fas fa-arrow-left" style="color: #666;"></i> Voltar
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block search_form %}{% endblock %}
{% block extra_filters %}{% endblock %}

{% block table_headers %}
    <tr>
        <th>Nome do Perfil</th>
        <th style="text-align: center;">Permissões</th>
        <th style="text-align: center;">Usuários Vinculados</th>
        <th style="width: 120px; text-align: center;">Ações</th>
    </tr>
{% endblock %}

{% block table_row %}
    <td class="align-middle">
        <div style="font-weight: 700; color: #2563EC; font-size: 14px;">
            {{ object.name }}
        </div>
        <div style="font-size: 12px; color: #858796; margin-top: 2px;">
            {{ object.detalhe.descricao|default:"Sem descrição definida." }}
        </div>
    </td>
    <td style="text-align: center;" class="align-middle">
        <span class="badge badge-info">{{ object.permissions.count }} permissões</span>
    </td>
    <td style="text-align: center;" class="align-middle">
        <span style="color: var(--text-secondary); font-weight: 500;">
            <i class="fas fa-user-friends mr-1" style="color: #b7b9cc;"></i> 
            {{ object.total_usuarios }} usuário{{ object.total_usuarios|pluralize }}
        </span>
    </td>
    <td style="text-align: center;" class="align-middle">
        <div class="action-buttons" style="justify-content: center;">
            {% if perms.auth.change_group %}
            <a href="{% url 'usuarios:editar_grupo' object.pk %}" class="btn btn-secondary btn-icon" title="Editar Perfil"
               style="background: #fff; border: 1px solid #d1d3e2; color: #858796;">
                <i class="fas fa-edit"></i>
            </a>
            {% endif %}

            {% if perms.auth.delete_group %}
            <button type="button" class="btn btn-danger btn-icon" title="Deletar Perfil"
                    onclick="confirmDelete('{% url 'usuarios:deletar_grupo' object.pk %}', '{{ object.name }}')">
                <i class="fas fa-trash"></i>
            </button>
            {% endif %}
        </div>
    </td>
{% endblock %}